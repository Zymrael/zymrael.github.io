<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="Self.">
  <meta name="keywords" content="Neural Implicit Representations, Fractals, Compression, Deep Generative Models">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Self-Similarity Priors: Neural Collages as Differentiable Fractal Representations</title>

  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script>
    <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <link rel="icon" href="../assets/img/diffeqml.png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  
</head>
<body>

<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://zymrael.github.io/">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>
    </div>

  </div>
</nav>


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-size-3 publication-title">Self-Similarity Priors: <br/> Neural Collages as Differentiable Fractal Representations</h1>
          <div class="is-size-6 publication-authors">
            <span class="author-block">
              <a href="https://zymrael.github.io/">Michael Poli*</a><sup>1</sup>,</span>
            <span class="author-block">
              <a href="https://winniexu.ca/">Winnie Xu*</a><sup>2</sup>,</span>
            <span class="author-block">
              <a href="https://massastrello.github.io/">Stefano Massaroli*</a><sup>3</sup>,
            </span>
            <span class="author-block">
              <a href="https://cs.stanford.edu/~chenlin/">Chenlin Meng</a><sup>1</sup>,
            </span>
            <span class="author-block">
              <a href="">Kuno Kim</a><sup>1</sup>,
            </span>
            <span class="author-block">
              <a href="https://cs.stanford.edu/~ermon/">Stefano Ermon</a><sup>1</sup>
            </span>
          </div>
          <div class="is-size-6 publication-authors">
            <span class="author-block"><sup>1</sup>Stanford University, </span>
            <span class="author-block"><sup>2</sup>University of Toronto, </span>
            <span class="author-block"><sup>3</sup>University of Tokyo, </span>
            <span class="author-block"><sup>*</sup>Equal contribution</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href="https://arxiv.org/abs/2204.07673#:~:text=Self%2DSimilarity%20Priors%3A%20Neural%20Collages%20as%20Differentiable%20Fractal%20Representations,-Michael%20Poli%2C%20Winnie&text=Many%20patterns%20in%20nature%20exhibit,described%20via%20self%2Dreferential%20transformations."
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>arXiv</span>
                </a>
              </span>
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/ermongroup/self-similarity-prior"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <!-- Gradio Link. -->
              <span class="link-block">
                <a href="https://huggingface.co/spaces/Zymrael/Neural-Collage-Fractalization"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fa fa-stop-circle"></i>
                  </span>
                  <span>Gradio</span>
                  </a>
              </span>
              <!-- Tutorial Link-->
              <span class="link-block">
                <a href="https://github.com/DiffEqML/models/blob/main/notebooks/neural_collage_operators.ipynb"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fa fa-book"></i>
                  </span>
                  <span>Notebook</span>
                  </a>
                </span>

            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="hero teaser">
  <div class="container is-max-desktop">
    <div class="hero-body">
      <h2 class="content has-text-centered is-size-9">
        <p>
        Representing <span class="deolive">data</span> as the <span class="dewine">parameters</span> of an <span class="deblue">iterative map</span>. </br>Given a set of parameters, the data is recovered as the (unique) fixed-point of the map.
      </p>
        <video id="" controls autoplay muted loop playsinline>
        <source src="./assets/CollageSteps.mp4" type="video/mp4">
      </video>
      <h2>
        <section class="section">
          <div class="container is-max-desktop">
                <h2 class="title is-4 has-text-centered">Summary</h2>
        
                <div class="content has-text-justified">
                  <p>
                    Many patterns in nature exhibit self–similarity: they can be efficiently described via self–referential
                    transformations. This property is common in natural and artificial objects, such as molecules,
                    shorelines, galaxies and even images. This work develops a method to learn representations designed to maximally leverage self-similarity, both across regions of a single datum as well as across datasets.
                  </p>
                  <p>
                    To this end, we propose to represent data as the parameters of a contractive, iterative map defined on partitions of the data space: the collage operator. Instead of performing extensive search for the set of parameters corresponding
                    to each element, we use a neural network encoder to amortize the cost to a single forward pass. We refer to the encoder and collage operator together as a Neural Collage.
                  </p>
                  <p>
                    We investigate how to leverage collage representations produced by Neural Collages in various tasks, including generation and compression.
                    Neural Collage are orders of magnitude faster than self–similarity–based
                    image compression algorithms during encoding and offer compression rates competitive with other deep implicit methods. We showcase further applications of Neural Collages as a method to produce fractal art.
                  </p>
              </div>
            </div>
        
          </br>
        </br>
        <div class="content has-text-justified">
          <h2 class="title is-4 has-text-centered">Intuition</h2>
            <p>
            Data can be represented in a variety of ways. In the original space, 
            via a collection of values (for example, pixels), as a set of coefficients and bases functions (for example, Fourier coefficients and complex exponentials), or 
            implicitly via the parameters of a map (for example, pixel locations to pixel values). 
            </p>
          <p>
            Although the standard in deep learning is to stack learned transformations on data, a "good" representation for the input is often the key to improved performance and more efficient, smaller models. To give a few examples:
            transformers, diffusion models, implicit neural representations (SIREN, NeRF, COIN) and frequency-domain models (FNOs, T1) all rely to a different extent on preprocessing / augmenting inputs and their domains (for example, grids of pixel locations). 
            The design space here involves parametrization of the input domains, positional encoding schemes, and choice of frequency-domain transforms. 
          </p>
          <p>
            In this work we investigate a different class of representations, where a data point is described via the parameters of a function that converges to it regardless of the initial condition.
            In particular, we consider contractive functions that by construction require a small number of parameters: collage operators. 
            Decoding (parameters to data) is achieved by applying a collage operator until convergence, or solving for its fixed-point. Encoding (data to parameters) is solved via a neural network encoder trained 
            to produce collage parameters corresponding to data.
          </p>
          <p>  
          A <b>Neural Collage</b> is comprised of both neural network encoder as well as collage operator as decoder. 
          </p>
          </div>

    </br>
      <h2 class="title is-4 has-text-centered">Example</h2>
            <div class="columns is-centered has-text-justified">
              <div class="column is-7">  
                <p>
                Consider a two-dimensional vector \(x \in \mathbb{R}^2\) that happens to be of interest
                for a downstream task, for example regression. Rather than representing it directly, we can
                use the parameters \(w\) of a contractive map with \(x \) as its fixed-point, for example a simple affine function:
                </br>
                \[{
                  x_{k+1} = a \circ x_k + b,\quad |a|< 1
                  }\]
              </p>
              <p>
                Given \(w\), \(x\) can be recovered by repeatedly applying the map starting from any other point as shown on the right. 
                We are now using four real numbers instead of the two elements of \(x\): not exactly a gain! 
              </p>                
              <p>
                However, choosing other classes of functions can help reduce the number of parameters required, as is the case for collage operators. Note that this is generally a lossy process, meaning
                that the original data is only recovered to a certain degree of accuracy.
              </p>
              </div>
                <div class="column is-4">
                  <video id="" autoplay muted loop playsinline>
                  <source src="./assets/test.mp4" type="video/mp4">
                </div>
            </div>
          </br>

            <div class="content has-text-justified">
              <h2 class="title is-4 has-text-centered">Applications</h2>
              <p>
              We show how collage parameter representations obtained through Neural Collages can be used in learning tasks:
            </p>
            </div>

      <img src="./assets/diagram.svg", 
      alt="Applications of Neural Collage Operators">
      </div>
     </div>
</section>



  <section class="core">
    <div class="container is-max-desktop has-text-centered">
      <h4 class="title is-4">Collage operator in code</h4>
      <div class="content has-text-justified">
      <pre><code class="python">    def collage_operator(self, z, collage_weight, collage_bias):
        """Collage Operator (decoding). Performs the steps described in  Def. 3.1, Figure 2."""
    
        # Split the current iterate `z` into source patches according to the partitioning scheme.
        domains = img_to_patches(z)
    
        # Pool domains (pre augmentation) to range patch sizes.
        pooled_domains = self.pool(domains) 
    
        # If needed, produce additional candidate source patches as augmentations of existing domains.
        # Auxiliary learned feature maps / patches are also introduced here.
        if self.n_aug_transforms > 1:
            pooled_domains = self.generate_candidates(pooled_domains)
    
        pooled_domains = repeat(pooled_domains, 'b c d h w -> b c d r h w', r=self.num_ranges)
    
        # Apply the affine maps to source patches
        range_domains = torch.einsum('bcdrhw, bcdr -> bcrhw', pooled_domains, collage_weight)
        range_domains = range_domains + collage_bias[..., None, None]
    
        # Reconstruct data by "composing" the output patches back together (collage!).
        z = patches_to_img(range_domains)
    
        return z</code></pre>

        <p>
          We choose collage operators for the following properties: 
        </p>
        <div class ="columns is-centered has-text-centered">

          <div class="column is-6">
            <h4 class="title is-5">Short parametrization</h4>
            <div class="content has-text-justified">
              <p>Collages require only two scalar parameters for each combination of input and output patches. In the paper, we formalize generalized collage operators as an instance of "iterated function system"
                 clarifying some of the details. In practice we broadcast the "scalar" affine map to each pixel in the patch. 

              </p>
            </div>
 
            
          </div>
          <div class="column is-6">
            <h4 class="title is-5">Resolution independent</h4> 
            <div class="content has-text-justified">
              <p>The resolution of each patch does not matter, as each affine map is broadcasted to all pixels. This allows the collage operator to be 
                applied to data of different resolutions. The detail introduced in higher resolution images reflects the structure of the collage operator: 
                when the entire image as used as an input patch, a fractal effect. With high enough resolutions, multiple levels of "fractalness" can be observed.
              </p>
            </div>

        </div>
        </div>

        <div class ="columns is-centered has-text-centered">
          <div class="column is-6">
            <h4 class="title is-5">Unique fixed-point</h4> 
            <div class="content has-text-justified">
              <p>A single set of collage parameters \(w\) identifies a unique data point. Contractiveness can be enforced
                 easily by constraining each affine map between input and output patches.
              </p>
            </div>
          </div>

          <div class="column is-6">
            <h4 class="title is-5">Efficient training</h4> 
            <div class="content has-text-justified">
              <p>A Neural Collages encoder can be trained to produce collage parameters via a reconstruction objective. Classical results on 
                contraction maps provide a method to upper bound the distance between input data and fixed-point of a collage by a single collage operator step,
                rather than by solving explicitly for the fixed-point.

              </p>
            </div>
        </div>
        </div>

        <h4 class="title is-5">Partitions matter</h4> 
        <div class="columns is-centered has-text-justified">

          <div class="column is-4">
            <div class="content has-text-justified">
              <p>Partitioning schemes directly affect
                the size of the representation: larger patches yield shorter parametrizations, but a loss of accuracy. On the right, 
                we show the decoding steps of a collage operator. 
              </p>
              <p>
                Increasing the size output patches reduces the accuracy and requires significantly smaller number of floats to represent the image, resulting in high compression ratios.
                This example does not employ techniques used in our Neural Collage compression experiments, such as training on random crops and bit-packing collage parameters. Thank you DALLE-2 for the image!
              </p>
               </p>

            </div>


          </div>

          <div class="column is-8">
            <section class="hero is-light">
              <div class="hero-body">
                <div class="container">
                  <div id="results-carousel" class="two-slide-carousel results-carousel">
                    <div class="item item2">
                      <video id="" autoplay muted loop playsinline, height="100%">
                        <source src="./assets/ds_small.mp4" type="video/mp4">
                      </video>
                    </div>
                    <div class="item item">
                      <video id="" autoplay muted loop playsinline, height="100%">
                        <source src="./assets/d4_small.mp4" type="video/mp4">
                      </video>
                    </div>
                    <div class="item item">
                      <video id="" autoplay muted loop playsinline, height="100%">
                        <source src="./assets/d8_small.mp4" type="video/mp4">
                      </video>
                    </div>
                    <div class="item item">
                      <video id="" autoplay muted loop playsinline, height="100%">
                        <source src="./assets/d16_small.mp4" type="video/mp4">
                      </video>
                    </div>
                      <div class="item item">
                        <video id="" autoplay muted loop playsinline, height="100%">
                          <source src="./assets/d32_small.mp4" type="video/mp4">
                        </video>
                      </div>
                    </div>            
                  </div>
                </div>
              </section>
          </div>

        </div>


         
        
        
        
    </div>
  </section>

  <section class="fin">
    <div class="container is-max-desktop has-text-centered">
        <h4 class="title is-3">Showcase</h4> 
        <h4 class="title is-4">Neural Collages as Generative Models</h4> 
        <div class="content has-text-justified">
          <p>
          We train deep generative models (VDVAEs) with collage parameters as latent variables. The ELBO is calculated on the images decoded through the collage operator, given a sample of collage parameters. 
          Collage parameter representations are "rate efficient" and generally significantly smaller than data dimensionality, resulting generative models that can be easier to optimize.
        </p>
          <p>
          Regardless of the image size used during training, introducing Neural Collages in a generative model allows for sampling at arbitrary resolution. Note that the details introduced
          by the upsampling depend on the type of collage operator, for example augmentation transforms used to produce auxiliary patches from domain patches at each iteration. 
        </p>
        </div>
        <div class="columns is-centered has-text-centered">

          <div class="column is-two-fourths">
            <div class="content has-text-justified">
              Binarized MNIST samples from a Collage VDVAE decoded at the standard resolution (28x28).
            </div>
          <image src="./assets/1x_superres.png" alt="Collage as Generative Model">     
          </div>
          <div class="column is-two-fourths">
            <div class="content has-text-justified">
            Binarized MNIST samples from a Collage VDVAE decoded at 40x the resolution (1440x1440).
          </div>
          <image src="./assets/40x_superres_vdcvae.png" alt="Collage as Generative Model">     
        </div>

        </div>
    <h4 class="title is-4">Neural Collages as Image Compressors</h4> 
    <div class="content has-text-justified">
      <p>
      We train Neural Collages on random crops of a datasets of high-resolution aerial images. At test time, we use pretrained encoder to compress images of different resolutions by applying it to
      each crop individually. Compression only requires a single forward pass of a Neural Collage encoder, resulting in several orders of magnitude speedups over fractal compression and COIN.
      </p>
      <p>
      To leverage similarity across the entire dataset, we introduce auxiliary input patches into a collage iteration (the "generate candidates" step in code). Better compression ratios
      are achieved by regularizing the collage parameters to assume small values, followed by a bit-packing step.
    </p>
    </div>
    <section class="hero is-light is-small">
      <div class="hero-body">
        <div class="container">
          <div id="results-carousel" class="carousel results-carousel">
            <div class="item item">
              <image src="./assets/source1.png" alt="Collage as Image Compressor">
              </video>
            </div>
            <div class="item item">
              <image src="./assets/fc1.png" alt="Collage as Image Compressor">
              </video>
            </div>
            <div class="item item">
              <image src="./assets/coin1.png" alt="Collage as Image Compressor">
              </video>
            </div>
            <div class="item item">
              <image src="./assets/nc1.png" alt="Collage as Image Compressor">
              </video>
            </div>
              <div class="item item">
                <image src="./assets/source2.png" alt="Collage as Image Compressor">
                </video>
              </div>
              <div class="item item">
                <image src="./assets/fc2.png" alt="Collage as Image Compressor">
                </video>
              </div>
              <div class="item item">
                <image src="./assets/coin2.png" alt="Collage as Image Compressor">
                </video>
              </div>
              <div class="item item">
                <image src="./assets/nc2.png" alt="Collage as Image Compressor">
                </video>
            </div>            
          </div>
        </div>
      </div>
    </section>
    <h4 class="title is-4">More applications</h4>
        <div class="content has-text-justified">
          <p>
          Neural Collages can fractalize images (see Gradio demo at the top of this page). To obtain this effect, train a restricted Neural Collage without source domain partitioning on a reconstruction objective i.e., with the only input patch being the entire image.
          Fractalizing (including training) takes less than a minute seconds on a single GPU. Follow the notebook tutorial for more details!  
        </p>
          <p>
            No author was harmed during the generation of these animations.
          </p>
      <section class="hero is-light">
        <div class="hero-body">
          <div class="container">
            <div id="results-carousel" class="carousel results-carousel">
              <div class="item item2">
                <video id="" autoplay muted loop playsinline, height="100%">
                  <source src="./assets/michael_zoom_small.mp4" type="video/mp4">
                </video>
              </div>
              <div class="item item">
                <video id="" autoplay muted loop playsinline, height="100%">
                  <source src="./assets/winnie_zoom_small.mp4" type="video/mp4">
                </video>
              </div>
              <div class="item item">
                <video id="" autoplay muted loop playsinline, height="100%">
                  <source src="./assets/massa_zoom_small.mp4" type="video/mp4">
                </video>
              </div>
              <div class="item item">
                <video id="" autoplay muted loop playsinline, height="100%">
                  <source src="./assets/chenlin_zoom_small.mp4" type="video/mp4">
                </video>
              </div>
                <div class="item item">
                  <video id="" autoplay muted loop playsinline, height="100%">
                    <source src="./assets/kuno_zoom_small.mp4" type="video/mp4">
                  </video>
                </div>
                <div class="item item">
                  <video id="" autoplay muted loop playsinline, height="100%">
                    <source src="./assets/stefano_zoom_small.mp4" type="video/mp4">
                  </video>
                </div>
              </div>            
            </div>
          </div>
        </section>
        </div>

    <div class="content has-text-justified">
      <p>
        There are questions left open for further investigation. We are looking into improved partitioning schemes, Neural Collages for other data modalities,
        training deep models directly on collage representations, and ways to control detail introduced when upsampling.
      </p>
    </div>

    <h4 class="title is-4">For experts of fractal compression</h4>
    <div class="columns is-centered">
      <div class="column has-text-justified is-5">
        <p>
      Neural Collages are inspired by Partitioned Iterated Function Systems (PIFS), the backbone of fractal compression schemes. Our official implementation includes a GPU-accelerated version of the PIFS algorithm (without quadtrees), used
      as a baseline in the image compression experiment. The main paper reports a detailed account of the history of fractal compression and its main variants.
    </p>
    </br>
    <p>
      And yes, Neural Collages can be applied to point clouds (as the first IFSs of Barnsley et al.) to produce "true" fractals!
    </p>
    </div>
    <div class="column has-text-justified is-4">
      <video id="" autoplay muted loop playsinline height="100%">
        <source src="./assets/a.mp4"
                type="video/mp4">
    </div>
  </div>
  </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="content has-text-centered">
      </div>
      <div class="columns is-centered">
        <div class="column is-8">
          <div class="content">
            <p>
              The format of this website is borrowed from the <a href="https://github.com/nerfies/nerfies.github.io">Nerfies</a> project website.
            </p>
            <p>
              This website is licensed under a <a rel="license"
                                                  href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons Attribution-ShareAlike 4.0 International License</a>.
            </p>
            <p>
              This means you are free to borrow the <a
                href="https://github.com/nerfies/nerfies.github.io">source code</a> of this website,
              we just ask that you link back to this page in the footer.
              Please remember to remove the analytics code included in the header of the website which
              you do not want on your website.
            </p>
          </div>
        </div>
      </div>
    </div>
  </footer>

</body>
</html>
)